// --- VYLEPŠENÁ DETEKCE KLIKNUTÍ ---
canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    // Klik na návěstidlo (zvětšená zóna na 25 pixelů)
    data.stanice[0].navestidla.forEach(n => {
        const dist = Math.hypot(mx - n.x, my - (n.y - 20));
        if(dist < 25) { 
            // Kontrola obsazenosti před postavením
            const isBlocked = data.stanice[0].koleje.some(k => k.occupied && k.x1 >= n.x);
            if (n.state === "stoj" && isBlocked) {
                log(`NELZE POSTAVIT: Úsek za návěstidlem ${n.id} je obsazen!`);
            } else {
                n.state = (n.state === "stoj") ? "volno" : "stoj";
                log(`Návěstidlo ${n.id} přepnuto na ${n.state.toUpperCase()}.`);
            }
        }
    });

    // ... (zbytek kódu pro výhybky zůstává)
});
